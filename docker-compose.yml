# Dokploy Docker Compose Configuration
# Environment variables should be configured in Dokploy UI

version: '3.4'

services:
  new-api:
    image: jeuneastre/new-api:test
    container_name: new-api
    restart: always
    ports:
      - "31000:3000"
    command: --log-dir /app/logs
    volumes:
      - ./data:/data
      - ./logs:/app/logs
    depends_on:
      - hydra
    healthcheck:
      test: ["CMD-SHELL", "wget -q -O - http://localhost:31000/api/status | grep -o '\"success\":\\s*true' || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
    env_file:
      - .env

  hydra:
    image: oryd/hydra:v2.2.0
    container_name: hydra
    restart: always
    ports:
      - "31001:4444"
    entrypoint: ["sh", "-c", "hydra migrate sql -e --yes && hydra serve all --dev"]
    env_file:
      - .env
